(this["webpackJsonpreference-field"]=this["webpackJsonpreference-field"]||[]).push([[0],{45:function(e,t,n){},50:function(e,t,n){"use strict";n.r(t);var i=n(0),s=n.n(i),r=n(23),a=n.n(r),c=n(26),o=n(2),u=n(7),l=n.n(u),d=n(11),f=n(13),p=n(14),h=n(9),m=n(16),v=n(15),j=n(24),g=n.n(j),b=n(1),y=null,x=null,O=null;function _(){null===x?(clearInterval(O),O=null):null===x||x.closed?null!==x&&x.closed&&(clearInterval(O),y.focus(),y.close({message:"child was closed"}),O=null,x=null):x.focus()}var k=function(e){Object(m.a)(n,e);var t=Object(v.a)(n);function n(e){var i;return Object(f.a)(this,n),(i=t.call(this,e)).onClickHandler=i.onClickHandler.bind(Object(h.a)(i)),y=window.self,i}return Object(p.a)(n,[{key:"onClickHandler",value:function(){var e=this.props,t=e.url,n=e.name,i=e.opts,s=e.refEntries;!x||x.closed?(x=y.open(t,n,i),setTimeout((function(){x.opener.postMessage({message:"Opening Reference Popup",selectedRefEntries:s},"*")}),0),null===O&&(O=setInterval(_,2e3))):x.focus()}},{key:"render",value:function(){var e=this.props.children;return Object(b.jsx)("button",{className:"choose_btn",type:"choose_btn",onClick:this.onClickHandler,children:e})}}]),n}(s.a.Component);k.defaultProps={name:"Reference Popup",opts:"dependent=".concat(1,", alwaysOnTop=",0,", alwaysRaised=",1,", width=",800,", height=",590,", left=",250,", top=",120)};var w=n(25),E=n.n(w),R=(n(45),function(e){Object(m.a)(n,e);var t=Object(v.a)(n);function n(e){var i;return Object(f.a)(this,n),(i=t.call(this,e)).handleFocus=function(){i.extension.field.setFocus()},i.removeEntry=function(e){var t=e.currentTarget.dataset.id,n=i.state.entryList;n.splice(n.findIndex((function(e){return e.uid===t})),1),i.saveExtensionData(n)},i.dragulaDecorator=function(e){if(e){g()([e],{copySortSource:!0})}},i.extension={},i.state={message:"",entryList:[],config:{},referenceTo:[],envList:[],initialLoader:!0},i.sonResponse=i.sonResponse.bind(Object(h.a)(i)),i.isEmpty=i.isEmpty.bind(Object(h.a)(i)),i}return Object(p.a)(n,[{key:"getProcessedEntry",value:function(e,t,n){var i=this;return new Promise((function(s){i.extension.stack.ContentType(e).Entry(t).addParam("include_publish_details","true").fetch().then(function(){var e=Object(d.a)(l.a.mark((function e(t){var r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=Object.assign({},t.entry,n),a=[],r.publish_details.map((function(e){return i.state.envList.length>0&&i.state.envList.environments.filter((function(t){t.uid===e.environment&&a.push(t.name)})),a})),r.publish_details=a,s(r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log(e)}))}))}},{key:"componentDidMount",value:function(){var e=this;E.a.init().then(function(){var n=Object(d.a)(l.a.mark((function n(i){var s,r;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(s=i.field.getData(),e.extension=i,i.window.enableAutoResizing(),i.stack.getEnvironments("get").then((function(t){e.setState({envList:t,apiKey:i.stack.getData().api_key})})),null===s||void 0===s||e.isEmpty(s)){n.next=11;break}return r=[],n.next=8,Promise.all(s.map(function(){var t=Object(d.a)(l.a.mark((function t(n){var i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getProcessedEntry(n._content_type_uid,n.uid,n);case 2:i=t.sent,r.push(i);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 8:e.setState({config:i.config,referenceTo:i.field.schema.reference_to,entryList:r,initialLoader:!1},(function(){i.window.enableAutoResizing(),window.addEventListener("message",t,!1)})),n.next=12;break;case 11:e.setState({config:i.config,referenceTo:i.field.schema.reference_to,initialLoader:!1},(function(){i.window.enableAutoResizing(),window.addEventListener("message",t,!1)}));case 12:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}());var t=function(t){var n=t.data,i=e.state,s=i.config,r=i.entryList,a=i.referenceTo,c=i.envList,o=s.query&&JSON.parse(s.query.replace(/\'/g,'"'));n.getConfig?t.source.postMessage({message:"Sending Config files",config:s,referenceTo:a,selectedRefEntries:r},t.origin):n.selectedRefEntries?e.saveExtensionData(n.selectedRefEntries):"add"===n.message?e.getEntries(n.selectedRef,n.skip).then((function(e){t.source.postMessage({message:"Sending entries",entries:e},t.origin)})):"loadmore"===n.message?e.getEntries(n.selectedRef,n.skip).then((function(e){t.source.postMessage({message:"loadmoreResult",loadmoreResult:e},t.origin)})):"search"===n.message&&(s.query?e.extension.stack.ContentType(n.selectedRef).Entry.Query().query(o).addParam("include_publish_details","true").addParam("include_count","true").limit(10).regex("title","^"+n.query,"i").find().then((function(e){e.entries.map((function(e){var t=[];e.publish_details.map((function(e){return c.environments.filter((function(n){n.uid===e.environment&&t.push(n.name)})),t})),e.publish_details=t,e._content_type_uid=n.selectedRef})),t.source.postMessage({message:"searchResult",searchResult:e},t.origin)})):e.extension.stack.ContentType(n.selectedRef).Entry.Query().addParam("include_publish_details","true").addParam("include_count","true").limit(10).regex("title","^"+n.query,"i").find().then((function(e){e.entries.map((function(e){var t=[];e.publish_details.map((function(e){return c.environments.filter((function(n){n.uid===e.environment&&t.push(n.name)})),t})),e.publish_details=t,e._content_type_uid=n.selectedRef})),t.source.postMessage({message:"searchResult",searchResult:e},t.origin)})))}}},{key:"getEntries",value:function(e,t){var n=this,i=this.state,s=i.config,r=i.envList,a=s.query&&JSON.parse(s.query.replace(/\'/g,'"'));return s.query?new Promise(function(){var i=Object(d.a)(l.a.mark((function i(s,c){return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n.extension.stack.ContentType(e).Entry.Query().query(a).addParam("include_publish_details","true").addParam("include_count","true").limit(10).skip(t[e]).find().then((function(t){t.entries.map((function(t){var n=[];t.publish_details.map((function(e){return r.environments.filter((function(t){t.uid===e.environment&&n.push(t.name)})),n})),t.publish_details=n,t._content_type_uid=e})),s(t)})).catch((function(e){console.log(e),c(e)}));case 1:case"end":return i.stop()}}),i)})));return function(e,t){return i.apply(this,arguments)}}()):new Promise(function(){var i=Object(d.a)(l.a.mark((function i(s,a){return l.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:n.extension.stack.ContentType(e).Entry.Query().addParam("include_publish_details","true").addParam("include_count","true").limit(10).skip(t[e]).find().then((function(t){t.entries.map((function(t){var n=[];t.publish_details.map((function(e){return r.environments.filter((function(t){t.uid===e.environment&&n.push(t.name)})),n})),t.publish_details=n,t._content_type_uid=e})),s(t)})).catch((function(e){console.log(e),a(e)}));case 1:case"end":return i.stop()}}),i)})));return function(e,t){return i.apply(this,arguments)}}())}},{key:"saveExtensionData",value:function(e){var t=[];e.forEach((function(e){t.push({uid:e.uid,_content_type_uid:e._content_type_uid})})),this.extension.field.setData(t),this.setState({entryList:e})}},{key:"sonResponse",value:function(e,t){e&&this.setState({message:t.message})}},{key:"isEmpty",value:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}},{key:"render",value:function(){var e=this,t=this.state,n=t.entryList,i=t.config,s=t.apiKey,r=t.initialLoader,a=window.location!=window.parent.location?document.referrer:document.location.href;return Object(b.jsx)("header",{className:"App-header",children:r?Object(b.jsx)("div",{className:"reference-loading",children:Object(b.jsxs)("div",{className:"loading-flash",children:[Object(b.jsx)("div",{}),Object(b.jsx)("div",{}),Object(b.jsx)("div",{}),Object(b.jsx)("div",{})]})}):Object(b.jsxs)("div",{className:"wrapper",id:"wrapper",onClick:this.handleFocus,children:[Object(b.jsxs)("div",{className:"container",children:[n.length>0?Object(b.jsxs)("div",{className:"selected-reference-count",children:[n.length," entry referenced"]}):"",Object(b.jsx)("div",{className:"main",children:Object(b.jsx)("div",{className:"selected-item",children:Object(b.jsx)("div",{className:"row selected-list",children:Object(b.jsx)("ul",{className:"drag1",ref:this.dragulaDecorator,children:null===n||void 0===n?void 0:n.map((function(t,n){return Object(b.jsx)("li",{id:t.uid,children:Object(b.jsxs)("div",{className:"file",children:[Object(b.jsxs)("div",{className:"entry-ref",children:[Object(b.jsx)("div",{children:t.title}),Object(b.jsxs)("div",{className:"content-type",children:["Content type: ",Object(b.jsx)("span",{children:t._content_type_uid})]})]}),Object(b.jsxs)("div",{className:"ref-action",children:[Object(b.jsx)("span",{className:"edit-entry",children:Object(b.jsx)("a",{href:"".concat(a,"#!/stack/").concat(s,"/content-type/").concat(t._content_type_uid,"/en-us/entry/").concat(t.uid,"/edit"),target:"_blank",children:Object(b.jsx)("img",{src:"https://app.contentstack.com/static/images/edit-icon-ref1.svg"})})}),Object(b.jsx)("span",{className:"file-action trash","data-id":t.uid,onClick:e.removeEntry.bind(e),children:Object(b.jsx)("img",{src:"https://app.contentstack.com/static/images/remove-entry.svg"})})]})]})},n)}))})})})})]}),Object(b.jsx)(k,{url:i.redirectUrl,bridge:this.sonResponse,refEntries:n,children:"Choose Entry"})]})})}}]),n}(s.a.Component));var C=function(){return Object(b.jsx)("div",{className:"App",children:Object(b.jsx)(c.a,{children:Object(b.jsx)(o.c,{children:Object(b.jsx)(o.a,{exact:!0,path:"/",component:R})})})})},P=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,51)).then((function(t){var n=t.getCLS,i=t.getFID,s=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),i(e),s(e),r(e),a(e)}))};a.a.render(Object(b.jsx)(s.a.StrictMode,{children:Object(b.jsx)(C,{})}),document.getElementById("root")),P()}},[[50,1,2]]]);
//# sourceMappingURL=main.f089d1f5.chunk.js.map